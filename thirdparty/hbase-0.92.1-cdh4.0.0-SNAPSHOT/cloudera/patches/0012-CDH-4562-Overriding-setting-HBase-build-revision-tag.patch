From 0859ff763129366d8cdcf3d2dfc667afcd471145 Mon Sep 17 00:00:00 2001
From: Himanshu <himanshu@cloudera.com>
Date: Fri, 30 Mar 2012 12:30:16 -0600
Subject: [PATCH 12/36] CDH-4562 Overriding/setting HBase build revision tag.

---
 pom.xml            |    2 ++
 src/saveVersion.sh |    4 ++++
 2 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/pom.xml b/pom.xml
index 742b8ed..e6d164f 100644
--- a/pom.xml
+++ b/pom.xml
@@ -712,6 +712,7 @@
 
                 <exec executable="sh">
                   <arg line="${basedir}/src/saveVersion.sh ${project.version} ${generated.sources}/java"/>
+                  <env key="HBASE_REVISION" value="${cloudera.hash}" />
                 </exec>
               </target>
             </configuration>
@@ -865,6 +866,7 @@
     <thrift.version>0.7.0</thrift.version>
     <zookeeper.version>${cdh.zookeeper.version}</zookeeper.version>
     <hadoop-snappy.version>${cdh.hadoop-snappy.version}</hadoop-snappy.version>
+    <cloudera.hash></cloudera.hash>
 
     <package.prefix>/usr</package.prefix>	           
     <package.conf.dir>/etc/hbase</package.conf.dir>  
diff --git a/src/saveVersion.sh b/src/saveVersion.sh
index baae4e2..6704b64 100755
--- a/src/saveVersion.sh
+++ b/src/saveVersion.sh
@@ -36,6 +36,10 @@ else
   revision="Unknown"
   url="file://$cwd"
 fi
+
+#allow override of revision using environment variable
+revision=${HBASE_REVISION:-$revision}
+
 mkdir -p "$outputDirectory/org/apache/hadoop/hbase"
 cat >"$outputDirectory/org/apache/hadoop/hbase/package-info.java" <<EOF
 /*
-- 
1.7.0.4

