From 39f7ef455f0824feee6714b7c22aa16962cc9f8a Mon Sep 17 00:00:00 2001
From: Matteo Bertozzi <matteo.bertozzi@cloudera.com>
Date: Mon, 7 Jan 2013 13:55:01 -0800
Subject: [PATCH 131/196] Fix EventType enum compatibility

Reason: Rolling upgrade failure
Author: Matteo Bertozzi
Ref: CDH-9699
---
 .../apache/hadoop/hbase/executor/EventHandler.java |   10 +++++++---
 1 files changed, 7 insertions(+), 3 deletions(-)

diff --git a/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java b/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java
index 1be8a0f..9944c64 100644
--- a/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java
+++ b/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java
@@ -128,8 +128,6 @@ public abstract class EventHandler implements Runnable, Comparable<Runnable> {
     C_M_DELETE_FAMILY         (45),   // Client asking Master to delete family of table
     C_M_MODIFY_FAMILY         (46),   // Client asking Master to modify family of table
     C_M_CREATE_TABLE          (47),   // Client asking Master to create a table
-    C_M_SNAPSHOT_TABLE        (48),   // Client asking Master to snapshot an offline table
-    C_M_RESTORE_SNAPSHOT      (49),   // Client asking Master to snapshot an offline table
 
     // Updates from master to ZK. This is done by the master and there is
     // nothing to process by either Master or RS
@@ -138,7 +136,13 @@ public abstract class EventHandler implements Runnable, Comparable<Runnable> {
 
     // Master controlled events to be executed on the master
     M_SERVER_SHUTDOWN         (70),  // Master is processing shutdown of a RS
-    M_META_SERVER_SHUTDOWN    (72);  // Master is processing shutdown of RS hosting a meta region (-ROOT- or .META.).
+    M_META_SERVER_SHUTDOWN    (72),  // Master is processing shutdown of RS hosting a meta region (-ROOT- or .META.).
+
+    // WARNING: Please do not insert, remove or swap any line in this enum.
+    // RegionTransitionData.write() uses eventType.ordinal() that is the enum index
+    // and not the value specified in the enum definition. so we can't add stuff in the middle.
+    C_M_SNAPSHOT_TABLE        (48),   // Client asking Master to snapshot an offline table
+    C_M_RESTORE_SNAPSHOT      (49);   // Client asking Master to snapshot an offline table
 
     /**
      * Constructor
-- 
1.7.0.4

