From 5892790a648023cce1010da2da9a887fd8b608f2 Mon Sep 17 00:00:00 2001
From: Gregory Chanan <gchanan@cloudera.com>
Date: Fri, 16 Nov 2012 15:37:50 -0800
Subject: [PATCH 041/196] HBASE-7170 [0.94 branch] Allow HConnectionImplementation to reconnect to master multiple times

Reason: Bug
Author: Gregory Chanan
Ref: CDH-9055
---
 .../hadoop/hbase/client/HConnectionManager.java    |   11 +----------
 1 files changed, 1 insertions(+), 10 deletions(-)

diff --git a/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java b/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java
index 37f4c1b..e3f483a 100644
--- a/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java
+++ b/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java
@@ -495,7 +495,6 @@ public class HConnectionManager {
     private volatile boolean closed;
     private volatile boolean aborted;
     private volatile HMasterInterface master;
-    private volatile boolean masterChecked;
     // ZooKeeper reference
     private volatile ZooKeeperWatcher zooKeeper;
     // ZooKeeper-based master address tracker
@@ -574,7 +573,6 @@ public class HConnectionManager {
           HConstants.DEFAULT_HBASE_CLIENT_PREFETCH_LIMIT);
 
       this.master = null;
-      this.masterChecked = false;
     }
 
     private synchronized void ensureZookeeperTrackers()
@@ -662,9 +660,7 @@ public class HConnectionManager {
         this.master = null;
 
         for (int tries = 0;
-          !this.closed &&
-          !this.masterChecked && this.master == null &&
-          tries < numRetries;
+          !this.closed && this.master == null && tries < numRetries;
         tries++) {
 
           try {
@@ -703,10 +699,6 @@ public class HConnectionManager {
             throw new RuntimeException("Thread was interrupted while trying to connect to master.");
           }
         }
-        // Avoid re-checking in the future if this is a managed HConnection,
-        // even if we failed to acquire a master.
-        // (this is to retain the existing behavior before HBASE-5058)
-        this.masterChecked = managed;
 
         if (this.master == null) {
           if (sn == null) {
@@ -1756,7 +1748,6 @@ public class HConnectionManager {
           HBaseRPC.stopProxy(master);
         }
         master = null;
-        masterChecked = false;
       }
       if (stopProxy) {
         for (HRegionInterface i : servers.values()) {
-- 
1.7.0.4

