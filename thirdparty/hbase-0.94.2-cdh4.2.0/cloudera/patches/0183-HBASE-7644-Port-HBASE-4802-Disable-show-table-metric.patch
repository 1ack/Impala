From 74b6f684c6d801a84f4a22486399699a249d1a36 Mon Sep 17 00:00:00 2001
From: Zhihong Yu <tedyu@apache.org>
Date: Tue, 22 Jan 2013 18:44:07 +0000
Subject: [PATCH 183/202] HBASE-7644 Port HBASE-4802 'Disable show table metrics in bulk loader' to 0.94

Reason: Bug
Author: Zhihong Yu
Ref: CDH-9997

git-svn-id: https://svn.apache.org/repos/asf/hbase/branches/0.94@1437091 13f79535-47bb-0310-9956-ffa450edef68
---
 .../regionserver/metrics/SchemaConfigured.java     |   10 ++++------
 .../hbase/regionserver/metrics/SchemaMetrics.java  |   10 +++++++---
 2 files changed, 11 insertions(+), 9 deletions(-)

diff --git a/src/main/java/org/apache/hadoop/hbase/regionserver/metrics/SchemaConfigured.java b/src/main/java/org/apache/hadoop/hbase/regionserver/metrics/SchemaConfigured.java
index 4821b53..7493951 100644
--- a/src/main/java/org/apache/hadoop/hbase/regionserver/metrics/SchemaConfigured.java
+++ b/src/main/java/org/apache/hadoop/hbase/regionserver/metrics/SchemaConfigured.java
@@ -74,12 +74,10 @@ public class SchemaConfigured implements HeapSize, SchemaAware {
 
   /** A helper constructor that configures the "use table name" flag. */
   private SchemaConfigured(Configuration conf) {
-    if (conf != null) {
-      SchemaMetrics.configureGlobally(conf);
-      // Even though we now know if table-level metrics are used, we can't
-      // initialize schemaMetrics yet, because CF and table name are only known
-      // to the calling constructor.
-    }
+    SchemaMetrics.configureGlobally(conf);
+    // Even though we now know if table-level metrics are used, we can't
+    // initialize schemaMetrics yet, because CF and table name are only known
+    // to the calling constructor.
   }
 
   /**
diff --git a/src/main/java/org/apache/hadoop/hbase/regionserver/metrics/SchemaMetrics.java b/src/main/java/org/apache/hadoop/hbase/regionserver/metrics/SchemaMetrics.java
index 9330834..62d3f8e 100644
--- a/src/main/java/org/apache/hadoop/hbase/regionserver/metrics/SchemaMetrics.java
+++ b/src/main/java/org/apache/hadoop/hbase/regionserver/metrics/SchemaMetrics.java
@@ -584,9 +584,13 @@ public class SchemaMetrics {
    * instantiating HFile readers/writers.
    */
   public static void configureGlobally(Configuration conf) {
-    final boolean useTableNameNew =
-        conf.getBoolean(SHOW_TABLE_NAME_CONF_KEY, false);
-    setUseTableName(useTableNameNew);
+    if (conf != null) {
+      final boolean useTableNameNew =
+          conf.getBoolean(SHOW_TABLE_NAME_CONF_KEY, false);
+      setUseTableName(useTableNameNew);
+    } else {
+      setUseTableName(false);
+    }
   }
 
   /**
-- 
1.7.0.4

