From cc4b01165f4e91f69b4c5732570a46bd13ac7061 Mon Sep 17 00:00:00 2001
From: Himanshu <himanshu@cloudera.com>
Date: Fri, 18 Jan 2013 14:10:36 -0700
Subject: [PATCH 165/196] HBASE-7562  ZKUtil: missing "else condition" in multi processing

Reason: Bug
Author: Himanshu Vashishtha
Ref: CDH-9925
---
 .../org/apache/hadoop/hbase/zookeeper/ZKUtil.java  |   16 +++++++++++-----
 1 files changed, 11 insertions(+), 5 deletions(-)

diff --git a/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java b/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java
index 78a0816..124525d 100644
--- a/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java
+++ b/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java
@@ -1467,6 +1467,7 @@ public class ZKUtil {
              LOG.info("On call to ZK.multi, received exception: " + ke.toString() + "."
                + "  Attempting to run operations sequentially because"
                + " runSequentialOnMultiFailure is: " + runSequentialOnMultiFailure + ".");
+             processSequentially(zkw, ops);
              break;
            }
           default:
@@ -1475,19 +1476,24 @@ public class ZKUtil {
       } catch (InterruptedException ie) {
         zkw.interruptedException(ie);
       }
+    } else {
+      // run sequentially
+      processSequentially(zkw, ops);
     }
+  }
 
-    // run sequentially
+  private static void processSequentially(ZooKeeperWatcher zkw, List<ZKUtilOp> ops)
+      throws KeeperException, NoNodeException {
     for (ZKUtilOp op : ops) {
       if (op instanceof CreateAndFailSilent) {
-        createAndFailSilent(zkw, (CreateAndFailSilent)op);
+        createAndFailSilent(zkw, (CreateAndFailSilent) op);
       } else if (op instanceof DeleteNodeFailSilent) {
-        deleteNodeFailSilent(zkw, (DeleteNodeFailSilent)op);
+        deleteNodeFailSilent(zkw, (DeleteNodeFailSilent) op);
       } else if (op instanceof SetData) {
-        setData(zkw, (SetData)op);
+        setData(zkw, (SetData) op);
       } else {
         throw new UnsupportedOperationException("Unexpected ZKUtilOp type: "
-          + op.getClass().getName());
+            + op.getClass().getName());
       }
     }
   }
-- 
1.7.0.4

