From 24da9747e837e8886971061a189e78887f6ae74c Mon Sep 17 00:00:00 2001
From: Matteo Bertozzi <matteo.bertozzi@cloudera.com>
Date: Thu, 20 Dec 2012 00:32:36 +0000
Subject: [PATCH 097/202] HBASE-7311 Add snapshot information to hbase master webui

Reason: Snapshots
Author: Matteo Bertozzi
Ref: CDH-9551
---
 .../hbase/tmpl/master/MasterStatusTmpl.jamon       |   33 +++++++++++++++++++-
 1 files changed, 32 insertions(+), 1 deletions(-)

diff --git a/src/main/jamon/org/apache/hadoop/hbase/tmpl/master/MasterStatusTmpl.jamon b/src/main/jamon/org/apache/hadoop/hbase/tmpl/master/MasterStatusTmpl.jamon
index 69434f7..4202984 100644
--- a/src/main/jamon/org/apache/hadoop/hbase/tmpl/master/MasterStatusTmpl.jamon
+++ b/src/main/jamon/org/apache/hadoop/hbase/tmpl/master/MasterStatusTmpl.jamon
@@ -43,6 +43,7 @@ org.apache.hadoop.hbase.client.HBaseAdmin;
 org.apache.hadoop.hbase.client.HConnectionManager;
 org.apache.hadoop.hbase.HTableDescriptor;
 org.apache.hadoop.hbase.HBaseConfiguration;
+org.apache.hadoop.hbase.protobuf.generated.HBaseProtos.SnapshotDescription;
 </%import>
 <%if format.equals("json") %>
   <& ../common/TaskMonitorTmpl; filter = filter; format = "json" &>
@@ -123,6 +124,7 @@ org.apache.hadoop.hbase.HBaseConfiguration;
 <%if (metaLocation != null) %>
 <& userTables &>
 </%if>
+<& userSnapshots &>
 <%if (servers != null) %>
 <& regionServers &>
 </%if>
@@ -169,7 +171,6 @@ org.apache.hadoop.hbase.HBaseConfiguration;
 <%def userTables>
 <%java>
    HTableDescriptor[] tables = admin.listTables();
-   HConnectionManager.deleteConnection(admin.getConfiguration(), false);
 </%java>
 <%if (tables != null && tables.length > 0)%>
 <table>
@@ -195,6 +196,32 @@ org.apache.hadoop.hbase.HBaseConfiguration;
 </%if>
 </%def>
 
+<%def userSnapshots>
+<%java>
+   List<SnapshotDescription> snapshots = admin.listSnapshots();
+</%java>
+<%if (snapshots != null && snapshots.size() > 0)%>
+<table>
+<tr>
+    <th>Snapshot</th>
+    <th>Table</th>
+    <th>Creation Time</th>
+    <th>Type</th>
+</tr>
+<%for SnapshotDescription snapshotDesc : snapshots%>
+<tr>
+    <td><% snapshotDesc.getName() %></td>
+    <td><a href="table.jsp?name=<% snapshotDesc.getTable() %>"><% snapshotDesc.getTable() %></a></td>
+    <td><% new Date(snapshotDesc.getCreationTime()) %></td>
+    <td><% snapshotDesc.getType() %></td>
+</tr>
+</%for>
+
+<p> <% snapshots.size() %> snapshot(s) in set.</p>
+</table>
+</%if>
+</%def>
+
 <%def regionServers>
 <h2>Region Servers</h2>
 <%if (servers != null && servers.size() > 0)%>
@@ -252,3 +279,7 @@ org.apache.hadoop.hbase.HBaseConfiguration;
 </table>
 </%if>
 </%def>
+
+<%java>
+   HConnectionManager.deleteConnection(admin.getConfiguration(), false);
+</%java>
-- 
1.7.0.4

