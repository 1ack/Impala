From b3a973ad2cd090dd5d001fa5f6558904c5fce330 Mon Sep 17 00:00:00 2001
From: Himanshu <himanshu@cloudera.com>
Date: Thu, 13 Dec 2012 14:23:32 -0700
Subject: [PATCH 061/202] HBASE-7338 Fix flaky condition for org.apache.hadoop.hbase.TestRegionRebalancing.testRebalanceOnRegionServerNumberChange
 Reason: Test
 Author: Himanshu Vashishtha
 Ref: CDH-9181

---
 .../apache/hadoop/hbase/TestRegionRebalancing.java |    7 ++++---
 1 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/src/test/java/org/apache/hadoop/hbase/TestRegionRebalancing.java b/src/test/java/org/apache/hadoop/hbase/TestRegionRebalancing.java
index 5574b7f..a9814f5 100644
--- a/src/test/java/org/apache/hadoop/hbase/TestRegionRebalancing.java
+++ b/src/test/java/org/apache/hadoop/hbase/TestRegionRebalancing.java
@@ -75,7 +75,7 @@ public class TestRegionRebalancing {
    * @throws IOException
    * @throws InterruptedException
    */
-  @Test
+  @Test (timeout=300000)
   public void testRebalanceOnRegionServerNumberChange()
   throws IOException, InterruptedException {
     HBaseAdmin admin = new HBaseAdmin(UTIL.getConfiguration());
@@ -218,9 +218,10 @@ public class TestRegionRebalancing {
    * Wait until all the regions are assigned.
    */
   private void waitForAllRegionsAssigned() throws IOException {
-    while (getRegionCount() < 22) {
+    int totalRegions = HBaseTestingUtility.KEYS.length+2;
+    while (getRegionCount() < totalRegions) {
     // while (!cluster.getMaster().allRegionsAssigned()) {
-      LOG.debug("Waiting for there to be 22 regions, but there are " + getRegionCount() + " right now.");
+      LOG.debug("Waiting for there to be "+ totalRegions +" regions, but there are " + getRegionCount() + " right now.");
       try {
         Thread.sleep(200);
       } catch (InterruptedException e) {}
-- 
1.7.0.4

