From 8f309b5701975f832bbbe6af4bf3ade71db9c32a Mon Sep 17 00:00:00 2001
From: Himanshu <himanshu@cloudera.com>
Date: Wed, 14 Nov 2012 11:31:06 -0700
Subject: [PATCH 039/202] CLOUDERA-BUILD Fix the pom to run all tests, and set environment variables

---
 pom.xml |   23 ++++++++++++++++++++++-
 1 files changed, 22 insertions(+), 1 deletions(-)

diff --git a/pom.xml b/pom.xml
index 062ed39..c6bbdf6 100644
--- a/pom.xml
+++ b/pom.xml
@@ -723,6 +723,19 @@
                 <parallel>classes</parallel><!-- surefire hack, if not we're using method parallelisation class !-->
                 <groups>${surefire.firstPartGroups}</groups>
                 <testFailureIgnore>false</testFailureIgnore>
+                <includes>
+            	  <include>${unittest.include}</include>
+          	</includes>
+		<excludes>
+                  <exlude>${integrationtest.include}</exlude>
+                  <exclude>**/*$*</exclude>
+                <exclude>${test.exclude.pattern}</exclude>
+            </excludes>
+            <environmentVariables>
+              <LD_LIBRARY_PATH>${env.LD_LIBRARY_PATH}:${project.build.directory}/nativelib</LD_LIBRARY_PATH>
+              <DYLD_LIBRARY_PATH>${env.DYLD_LIBRARY_PATH}:${project.build.directory}/nativelib</DYLD_LIBRARY_PATH>
+              <MALLOC_ARENA_MAX>4</MALLOC_ARENA_MAX>
+            </environmentVariables>
         </configuration>
         <executions>
           <execution>
@@ -1034,7 +1047,15 @@
     <surefire.firstPartGroups>org.apache.hadoop.hbase.SmallTests</surefire.firstPartGroups>
     <surefire.secondPartGroups>org.apache.hadoop.hbase.MediumTests</surefire.secondPartGroups>
     <test.output.tofile>true</test.output.tofile>
-  </properties>
+    <!-- For flaky tests exclusion -->
+    <test.exclude></test.exclude>
+    <test.exclude.pattern>**/${test.exclude}.java</test.exclude.pattern>
+    
+    <!-- Test inclusion patterns -->
+    <unittest.include>**/Test*.java</unittest.include>
+    <integrationtest.include>**/IntegrationTest*.java</integrationtest.include>
+  
+ </properties>
 
   <!-- Sorted by groups of dependencies then groupId and artifactId -->
   <dependencies>
-- 
1.7.0.4

