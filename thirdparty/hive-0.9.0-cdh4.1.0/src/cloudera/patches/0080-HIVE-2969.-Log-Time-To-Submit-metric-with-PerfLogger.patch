From e78bd3bce9d13ce2bf69006013d295a41e56490f Mon Sep 17 00:00:00 2001
From: Kevin Wilfong <kevinwilfong@apache.org>
Date: Fri, 8 Jun 2012 02:46:28 +0000
Subject: [PATCH 080/148] HIVE-2969. Log Time To Submit metric with PerfLogger. (kevinwilfong reviewed by ashutoshc)

git-svn-id: https://svn.apache.org/repos/asf/hive/trunk@1347870 13f79535-47bb-0310-9956-ffa450edef68
(cherry picked from commit 7212d3e8828033516780696adbb0cc54073f3ba0)
---
 ql/src/java/org/apache/hadoop/hive/ql/Driver.java  |    4 +++-
 .../org/apache/hadoop/hive/ql/log/PerfLogger.java  |    1 +
 2 files changed, 4 insertions(+), 1 deletions(-)

diff --git a/src/ql/src/java/org/apache/hadoop/hive/ql/Driver.java b/src/ql/src/java/org/apache/hadoop/hive/ql/Driver.java
index a6ce320..db93a24 100644
--- a/src/ql/src/java/org/apache/hadoop/hive/ql/Driver.java
+++ b/src/ql/src/java/org/apache/hadoop/hive/ql/Driver.java
@@ -69,8 +69,8 @@ import org.apache.hadoop.hive.ql.lockmgr.HiveLockManagerCtx;
 import org.apache.hadoop.hive.ql.lockmgr.HiveLockMode;
 import org.apache.hadoop.hive.ql.lockmgr.HiveLockObj;
 import org.apache.hadoop.hive.ql.lockmgr.HiveLockObject;
-import org.apache.hadoop.hive.ql.lockmgr.LockException;
 import org.apache.hadoop.hive.ql.lockmgr.HiveLockObject.HiveLockObjectData;
+import org.apache.hadoop.hive.ql.lockmgr.LockException;
 import org.apache.hadoop.hive.ql.log.PerfLogger;
 import org.apache.hadoop.hive.ql.metadata.AuthorizationException;
 import org.apache.hadoop.hive.ql.metadata.DummyPartition;
@@ -897,6 +897,7 @@ public class Driver implements CommandProcessor {
     // Reset the perf logger
     PerfLogger perfLogger = PerfLogger.getPerfLogger(true);
     perfLogger.PerfLogBegin(LOG, PerfLogger.DRIVER_RUN);
+    perfLogger.PerfLogBegin(LOG, PerfLogger.TIME_TO_SUBMIT);
 
     int ret = compile(command);
     if (ret != 0) {
@@ -1100,6 +1101,7 @@ public class Driver implements CommandProcessor {
         driverCxt.addToRunnable(tsk);
       }
 
+      perfLogger.PerfLogEnd(LOG, PerfLogger.TIME_TO_SUBMIT);
       // Loop while you either have tasks running, or tasks queued up
       while (running.size() != 0 || runnable.peek() != null) {
         // Launch upto maxthreads tasks
diff --git a/src/ql/src/java/org/apache/hadoop/hive/ql/log/PerfLogger.java b/src/ql/src/java/org/apache/hadoop/hive/ql/log/PerfLogger.java
index c1c3677..c77eb88 100644
--- a/src/ql/src/java/org/apache/hadoop/hive/ql/log/PerfLogger.java
+++ b/src/ql/src/java/org/apache/hadoop/hive/ql/log/PerfLogger.java
@@ -46,6 +46,7 @@ public class PerfLogger {
   public static final String POST_HOOK = "PostHook.";
   public static final String FAILURE_HOOK = "FailureHook.";
   public static final String DRIVER_RUN = "Driver.run";
+  public static final String TIME_TO_SUBMIT = "TimeToSubmit";
 
   protected static final ThreadLocal<PerfLogger> perfLogger = new ThreadLocal<PerfLogger>();
 
-- 
1.7.0.4

