From 6ada9b4969641887fc49549119d376cbf741df8c Mon Sep 17 00:00:00 2001
From: Carl Steinbach <cws@apache.org>
Date: Thu, 7 Jun 2012 05:27:36 +0000
Subject: [PATCH 078/148] Oracle Metastore schema script doesn't include DDL for DN internal tables (Carl Steinbach via cws)

git-svn-id: https://svn.apache.org/repos/asf/hive/trunk@1347396 13f79535-47bb-0310-9956-ffa450edef68
(cherry picked from commit 53d2750def6b2ab98a34cbe8e439d982af803a44)
---
 .../upgrade/oracle/hive-schema-0.9.0.oracle.sql    |   51 +++++++++++--------
 1 files changed, 29 insertions(+), 22 deletions(-)

diff --git a/src/metastore/scripts/upgrade/oracle/hive-schema-0.9.0.oracle.sql b/src/metastore/scripts/upgrade/oracle/hive-schema-0.9.0.oracle.sql
index e462083..7784046 100644
--- a/src/metastore/scripts/upgrade/oracle/hive-schema-0.9.0.oracle.sql
+++ b/src/metastore/scripts/upgrade/oracle/hive-schema-0.9.0.oracle.sql
@@ -1,25 +1,32 @@
-------------------------------------------------------------------
--- DataNucleus SchemaTool (version 2.0.3) ran at 10/08/2011 21:27:47
-------------------------------------------------------------------
---     org.apache.hadoop.hive.metastore.model.MDatabase
---     org.apache.hadoop.hive.metastore.model.MFieldSchema
---     org.apache.hadoop.hive.metastore.model.MType
---     org.apache.hadoop.hive.metastore.model.MTable
---     org.apache.hadoop.hive.metastore.model.MSerDeInfo
---     org.apache.hadoop.hive.metastore.model.MOrder
---     org.apache.hadoop.hive.metastore.model.MStorageDescriptor
---     org.apache.hadoop.hive.metastore.model.MPartition
---     org.apache.hadoop.hive.metastore.model.MIndex
---     org.apache.hadoop.hive.metastore.model.MRole
---     org.apache.hadoop.hive.metastore.model.MRoleMap
---     org.apache.hadoop.hive.metastore.model.MGlobalPrivilege
---     org.apache.hadoop.hive.metastore.model.MDBPrivilege
---     org.apache.hadoop.hive.metastore.model.MTablePrivilege
---     org.apache.hadoop.hive.metastore.model.MPartitionPrivilege
---     org.apache.hadoop.hive.metastore.model.MTableColumnPrivilege
---     org.apache.hadoop.hive.metastore.model.MPartitionColumnPrivilege
---     org.apache.hadoop.hive.metastore.model.MPartitionEvent
---
+
+
+-- Table SEQUENCE_TABLE is an internal table required by DataNucleus.
+-- NOTE: Some versions of SchemaTool do not automatically generate this table.
+-- See http://www.datanucleus.org/servlet/jira/browse/NUCRDBMS-416
+CREATE TABLE SEQUENCE_TABLE
+(
+   SEQUENCE_NAME VARCHAR2(255) NOT NULL,
+   NEXT_VAL NUMBER NOT NULL
+);
+
+ALTER TABLE SEQUENCE_TABLE ADD CONSTRAINT PART_TABLE_PK PRIMARY KEY (SEQUENCE_NAME);
+
+-- Table NUCLEUS_TABLES is an internal table required by DataNucleus.
+-- This table is required if datanucleus.autoStartMechanism=SchemaTable
+-- NOTE: Some versions of SchemaTool do not automatically generate this table.
+-- See http://www.datanucleus.org/servlet/jira/browse/NUCRDBMS-416
+CREATE TABLE NUCLEUS_TABLES
+(
+   CLASS_NAME VARCHAR2(128) NOT NULL,
+   TABLE_NAME VARCHAR2(128) NOT NULL,
+   TYPE VARCHAR2(4) NOT NULL,
+   OWNER VARCHAR2(2) NOT NULL,
+   VERSION VARCHAR2(20) NOT NULL,
+   INTERFACE_NAME VARCHAR2(255) NULL
+);
+
+ALTER TABLE NUCLEUS_TABLES ADD CONSTRAINT NUCLEUS_TABLES_PK PRIMARY KEY (CLASS_NAME);
+
 -- Table PART_COL_PRIVS for classes [org.apache.hadoop.hive.metastore.model.MPartitionColumnPrivilege]
 CREATE TABLE PART_COL_PRIVS
 (
-- 
1.7.0.4

