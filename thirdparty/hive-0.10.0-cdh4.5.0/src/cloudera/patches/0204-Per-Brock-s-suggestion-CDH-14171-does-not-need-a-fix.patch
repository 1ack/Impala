From 51f68d74995014f2a087e3a50f5082d22f519d2b Mon Sep 17 00:00:00 2001
From: Chaoyu Tang <ctang@cloudera.com>
Date: Fri, 20 Sep 2013 09:22:30 -0400
Subject: [PATCH 204/218] Per Brock's suggestion, CDH-14171 does not need a fix due to HADOOP-9958, and revert this commit.

---
 .../delegation/HiveDelegationTokenSupport.java     |   18 ++++--------------
 1 files changed, 4 insertions(+), 14 deletions(-)

diff --git a/src/shims/src/common-secure/java/org/apache/hadoop/security/token/delegation/HiveDelegationTokenSupport.java b/src/shims/src/common-secure/java/org/apache/hadoop/security/token/delegation/HiveDelegationTokenSupport.java
index ecaf40d..6b39a14 100644
--- a/src/shims/src/common-secure/java/org/apache/hadoop/security/token/delegation/HiveDelegationTokenSupport.java
+++ b/src/shims/src/common-secure/java/org/apache/hadoop/security/token/delegation/HiveDelegationTokenSupport.java
@@ -41,12 +41,6 @@ public final class HiveDelegationTokenSupport {
       WritableUtils.writeVInt(out, token.password.length);
       out.write(token.password);
       out.writeLong(token.renewDate);
-      if(token.getTrackingId() == null) {
-        out.writeByte((byte)0);
-      } else {
-        out.writeByte((byte)1);
-        out.writeUTF(token.getTrackingId());
-      }
       out.flush();
       return bos.toByteArray();
     } catch (IOException ex) {
@@ -57,15 +51,11 @@ public final class HiveDelegationTokenSupport {
   public static DelegationTokenInformation decodeDelegationTokenInformation(byte[] tokenBytes)
       throws IOException {
     DataInputStream in = new DataInputStream(new ByteArrayInputStream(tokenBytes));
+    DelegationTokenInformation token = new DelegationTokenInformation(0, null);
     int len = WritableUtils.readVInt(in);
-    byte[] password = new byte[len];
-    in.readFully(password);
-    long renewDate = in.readLong();
-    String trackingId = null;
-    if(in.readByte() == (byte)1) {
-      trackingId = in.readUTF();
-    }
-    DelegationTokenInformation token = new DelegationTokenInformation(renewDate, password, trackingId);
+    token.password = new byte[len];
+    in.readFully(token.password);
+    token.renewDate = in.readLong();
     return token;
   }
 
-- 
1.7.0.4

