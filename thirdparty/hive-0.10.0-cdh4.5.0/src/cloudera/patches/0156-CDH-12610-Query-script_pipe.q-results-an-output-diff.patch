From 7e20bda2f149396e564f49b8452b71069d0c2d1d Mon Sep 17 00:00:00 2001
From: xzhang <xzhang@xzdt.(none)>
Date: Wed, 10 Jul 2013 12:54:39 -0700
Subject: [PATCH 156/218] CDH-12610 Query script_pipe.q results an output diff when TestCliDriver is compiled on JDK7

---
 .../apache/hadoop/hive/ql/exec/ScriptOperator.java |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/src/ql/src/java/org/apache/hadoop/hive/ql/exec/ScriptOperator.java b/src/ql/src/java/org/apache/hadoop/hive/ql/exec/ScriptOperator.java
index 809695e..312416a 100644
--- a/src/ql/src/java/org/apache/hadoop/hive/ql/exec/ScriptOperator.java
+++ b/src/ql/src/java/org/apache/hadoop/hive/ql/exec/ScriptOperator.java
@@ -81,6 +81,7 @@ public class ScriptOperator extends Operator<ScriptDesc> implements
   transient RecordWriter scriptOutWriter = null;
 
   static final String IO_EXCEPTION_BROKEN_PIPE_STRING = "Broken pipe";
+  static final String IO_EXCEPTION_STREAM_CLOSED = "Stream closed";
   static final String IO_EXCEPTION_PIPE_ENDED_WIN = "The pipe has been ended";
   static final String IO_EXCEPTION_PIPE_CLOSED_WIN = "The pipe is being closed";
 
@@ -253,7 +254,8 @@ public class ScriptOperator extends Operator<ScriptDesc> implements
       return errMsg.equalsIgnoreCase(IO_EXCEPTION_PIPE_CLOSED_WIN) ||
           errMsg.equalsIgnoreCase(IO_EXCEPTION_PIPE_ENDED_WIN);
     }
-    return (e.getMessage().equalsIgnoreCase(IO_EXCEPTION_BROKEN_PIPE_STRING));
+    return (e.getMessage().equalsIgnoreCase(IO_EXCEPTION_BROKEN_PIPE_STRING) ||
+            e.getMessage().equalsIgnoreCase(IO_EXCEPTION_STREAM_CLOSED));
   }
 
   boolean allowPartialConsumption() {
-- 
1.7.0.4

