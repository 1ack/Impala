From 2b745d6e05655b5b7b2cc1e25c9ffd14d8b1d21d Mon Sep 17 00:00:00 2001
From: Zhihong Yu <tedyu@apache.org>
Date: Wed, 1 Feb 2012 17:34:04 +0000
Subject: [PATCH 047/151] HBASE-5310 HConnectionManager server cache key enhancement (Jimmy Xiang)

Reason: Improvement
Author: Jimmy Xiang
Ref: CDH-4317
---
 .../hadoop/hbase/client/HConnectionManager.java    |    6 +++---
 1 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java b/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java
index 7d8f1d5..052637f 100644
--- a/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java
+++ b/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java
@@ -1141,7 +1141,7 @@ public class HConnectionManager {
         for (Map<byte[], HRegionLocation> tableLocations :
           cachedRegionLocations.values()) {
           for (Entry<byte[], HRegionLocation> e : tableLocations.entrySet()) {
-            if (e.getValue().getServerAddress().toString().equals(server)) {
+            if (e.getValue().getHostnamePort().equals(server)) {
               tableLocations.remove(e.getKey());
               deletedSomething = true;
             }
@@ -1200,7 +1200,7 @@ public class HConnectionManager {
         getTableLocations(tableName);
       boolean hasNewCache = false;
       synchronized (this.cachedRegionLocations) {
-        cachedServers.add(location.getServerAddress().toString());
+        cachedServers.add(location.getHostnamePort());
         hasNewCache = (tableLocations.put(startKey, location) == null);
       }
       if (hasNewCache) {
@@ -1334,7 +1334,7 @@ public class HConnectionManager {
             // .META. again to find the new location
             HRegionLocation hrl = callable.location;
             if (hrl != null) {
-              clearCachedLocationForServer(hrl.getServerAddress().toString());
+              clearCachedLocationForServer(hrl.getHostnamePort());
             }
           }
           RetriesExhaustedException.ThrowableWithExtraContext qt =
-- 
1.7.0.4

