From fe4c6ef1546eff56eecf12ebee5af8eb06a4fde2 Mon Sep 17 00:00:00 2001
From: Michael Stack <stack@apache.org>
Date: Sat, 25 Aug 2012 05:32:05 +0000
Subject: [PATCH 137/151] HBASE-6662 Region server incorrectly reports its own address as master's address

Reason: Bug
Author: Shrijeet Paliwal
Ref: CDH-5549
---
 .../hadoop/hbase/regionserver/HRegionServer.java   |    7 ++++---
 1 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java b/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java
index d08f02f..53a6b59 100644
--- a/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java
+++ b/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java
@@ -1621,6 +1621,7 @@ public class HRegionServer implements HRegionInterface, HBaseRPCErrorHandler,
   private ServerName getMaster() {
     ServerName masterServerName = null;
     HMasterRegionInterface master = null;
+    InetSocketAddress masterIsa = null;
     while (keepLooping() && master == null) {
       masterServerName = this.masterAddressManager.getMasterAddress();
       if (masterServerName == null) {
@@ -1634,7 +1635,7 @@ public class HRegionServer implements HRegionInterface, HBaseRPCErrorHandler,
         continue;
       }
 
-      InetSocketAddress isa =
+      masterIsa =
         new InetSocketAddress(masterServerName.getHostname(), masterServerName.getPort());
 
       LOG.info("Attempting connect to Master server at " +
@@ -1644,7 +1645,7 @@ public class HRegionServer implements HRegionInterface, HBaseRPCErrorHandler,
         // should retry indefinitely.
         master = (HMasterRegionInterface) HBaseRPC.waitForProxy(
             HMasterRegionInterface.class, HMasterRegionInterface.VERSION,
-            isa, this.conf, -1,
+            masterIsa, this.conf, -1,
             this.rpcTimeout, this.rpcTimeout);
       } catch (IOException e) {
         e = e instanceof RemoteException ?
@@ -1657,7 +1658,7 @@ public class HRegionServer implements HRegionInterface, HBaseRPCErrorHandler,
         sleeper.sleep();
       }
     }
-    LOG.info("Connected to master at " + isa);
+    LOG.info("Connected to master at " + masterIsa);
     this.hbaseMaster = master;
     return masterServerName;
   }
-- 
1.7.0.4

