From 18ad4842da90b46a5a7fce3fcfcd2696cec84e87 Mon Sep 17 00:00:00 2001
From: Gregory Chanan <gchanan@cloudera.com>
Date: Fri, 27 Jul 2012 14:21:54 -0700
Subject: [PATCH 095/151] HBASE-5922 HalfStoreFileReader seekBefore causes StackOverflowError

Reason: Backport
Author: Nate Putnam
Ref: CDH-6903
---
 .../hadoop/hbase/io/HalfStoreFileReader.java       |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/src/main/java/org/apache/hadoop/hbase/io/HalfStoreFileReader.java b/src/main/java/org/apache/hadoop/hbase/io/HalfStoreFileReader.java
index da3c774..3e660c8 100644
--- a/src/main/java/org/apache/hadoop/hbase/io/HalfStoreFileReader.java
+++ b/src/main/java/org/apache/hadoop/hbase/io/HalfStoreFileReader.java
@@ -144,9 +144,10 @@ public class HalfStoreFileReader extends StoreFile.Reader {
             return false;
           }
         } else {
+          // The equals sign isn't strictly necessary just here to be consistent with seekTo
           if (getComparator().compare(key, offset, length, splitkey, 0,
               splitkey.length) >= 0) {
-            return seekBefore(splitkey, 0, splitkey.length);
+            return this.delegate.seekBefore(splitkey, 0, splitkey.length);
           }
         }
         return this.delegate.seekBefore(key, offset, length);
-- 
1.7.0.4

