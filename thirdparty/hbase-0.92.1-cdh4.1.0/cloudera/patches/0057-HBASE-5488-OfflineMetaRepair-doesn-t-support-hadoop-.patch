From ff58c0ad2a2b1c3bb0c7ab2ef31c9f5102203942 Mon Sep 17 00:00:00 2001
From: Jonathan Hsieh <jmhsieh@apache.org>
Date: Fri, 13 Apr 2012 06:44:53 +0000
Subject: [PATCH 057/154] HBASE-5488 OfflineMetaRepair doesn't support hadoop 0.20's fs.default.name property (gaojinchao)

Reason: Bug
Author: Gaojinchao
Ref: CDH-5570
---
 .../hadoop/hbase/util/hbck/OfflineMetaRepair.java  |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/src/main/java/org/apache/hadoop/hbase/util/hbck/OfflineMetaRepair.java b/src/main/java/org/apache/hadoop/hbase/util/hbck/OfflineMetaRepair.java
index d73821a..468f19d 100644
--- a/src/main/java/org/apache/hadoop/hbase/util/hbck/OfflineMetaRepair.java
+++ b/src/main/java/org/apache/hadoop/hbase/util/hbck/OfflineMetaRepair.java
@@ -62,7 +62,10 @@ public class OfflineMetaRepair {
 
     // create a fsck object
     Configuration conf = HBaseConfiguration.create();
+    // Cover both bases, the old way of setting default fs and the new.
+    // We're supposed to run on 0.20 and 0.21 anyways.
     conf.set("fs.defaultFS", conf.get(HConstants.HBASE_DIR));
+    conf.set("fs.default.name", conf.get(HConstants.HBASE_DIR));
     HBaseFsck fsck = new HBaseFsck(conf);
     boolean fixHoles = false;
 
@@ -76,6 +79,7 @@ public class OfflineMetaRepair {
         i++;
         String path = args[i];
         conf.set(HConstants.HBASE_DIR, path);
+        conf.set("fs.default.name", conf.get(HConstants.HBASE_DIR));
         conf.set("fs.defaultFS", conf.get(HConstants.HBASE_DIR));
       } else if (cmd.equals("-fixHoles")) {
         fixHoles = true;
-- 
1.7.0.4

