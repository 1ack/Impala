From c4a1510c9a934721bd3192467f0da3cd6725ca2b Mon Sep 17 00:00:00 2001
From: Matteo Bertozzi <matteo.bertozzi@cloudera.com>
Date: Tue, 29 May 2012 23:54:20 +0200
Subject: [PATCH 061/154] HBASE-6068 Secure HBase cluster: Client not able to call some admin APIs

Reason: Bug
Author: Matteo Bertozzi
Ref: CDH-5207
---
 .../org/apache/hadoop/hbase/zookeeper/ZKUtil.java  |   11 ++++++++---
 1 files changed, 8 insertions(+), 3 deletions(-)

diff --git a/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java b/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java
index d939151..20f30b3 100644
--- a/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java
+++ b/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java
@@ -711,10 +711,15 @@ public class ZKUtil {
 
   private static ArrayList<ACL> createACL(ZooKeeperWatcher zkw, String node) {
     if (isSecureZooKeeper(zkw.getConfiguration())) {
-      // Certain znodes must be readable by non-authenticated clients
-      if ((node.equals(zkw.rootServerZNode) == true) ||
+      // Certain znodes are accessed directly by the client,
+      // so they must be readable by non-authenticated clients
+      if ((node.equals(zkw.baseZNode) == true) ||
+          (node.equals(zkw.rootServerZNode) == true) ||
           (node.equals(zkw.masterAddressZNode) == true) ||
-          (node.equals(zkw.clusterIdZNode) == true)) {
+          (node.equals(zkw.clusterIdZNode) == true) ||
+          (node.equals(zkw.rsZNode) == true) ||
+          (node.equals(zkw.backupMasterAddressesZNode) == true) ||
+          (node.startsWith(zkw.tableZNode) == true)) {
         return ZooKeeperWatcher.CREATOR_ALL_AND_WORLD_READABLE;
       }
       return Ids.CREATOR_ALL_ACL;
-- 
1.7.0.4

