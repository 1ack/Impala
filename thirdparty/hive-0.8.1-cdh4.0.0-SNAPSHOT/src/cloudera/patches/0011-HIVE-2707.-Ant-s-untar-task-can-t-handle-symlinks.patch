From 81acfb6939754df6934199375496fae6860a0fcc Mon Sep 17 00:00:00 2001
From: Carl Steinbach <carl@cloudera.com>
Date: Tue, 10 Jan 2012 18:18:49 -0800
Subject: [PATCH 11/58] HIVE-2707. Ant's untar task can't handle symlinks

Reason: Bug
Author: Carl Steinbach
Ref: CDH-4090
---
 build-common.xml |    7 ++++++-
 1 files changed, 6 insertions(+), 1 deletions(-)

diff --git a/src/build-common.xml b/src/build-common.xml
index 618ae8d..055fcb5 100644
--- a/src/build-common.xml
+++ b/src/build-common.xml
@@ -176,7 +176,12 @@
     <echo message="Project: ${ant.project.name}"/>
     <move tofile="${build.dir.hadoop}/hadoop-${hadoop.version.ant-internal}.tar.gz"
           file="${build.dir.hadoop}/hadoop-dist-${hadoop.version.ant-internal}.tar.gz" />
-    <untar src="${build.dir.hadoop}/hadoop-${hadoop.version.ant-internal}.tar.gz" dest="${build.dir.hadoop}" compression="gzip"/>
+    <!-- Ant's untar task can't handle symlinks, so we directly exec tar instead -->
+    <!-- Ref: https://issues.apache.org/bugzilla/show_bug.cgi?id=19252 -->
+    <exec executable="tar" dir="${build.dir.hadoop}">
+      <arg value="-xvzf"/>
+      <arg value="hadoop-${hadoop.version.ant-internal}.tar.gz"/>
+    </exec>
     <chmod file="${hadoop.root}/bin/hadoop" perm="+x"/>
     <touch file="${build.dir.hadoop}/hadoop-${hadoop.version.ant-internal}.installed"/>
   </target>
-- 
1.7.0.4

