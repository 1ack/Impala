From aed333ea0c0df767c4659704b25be96a6ffffd9d Mon Sep 17 00:00:00 2001
From: Andrew Bayer <andrew@cloudera.com>
Date: Mon, 13 Feb 2012 15:03:56 -0800
Subject: [PATCH 28/58] CLOUDERA-BUILD. Adding test classpath to shims test compilation.

---
 shims/build.xml |   14 ++++++++++++--
 1 files changed, 12 insertions(+), 2 deletions(-)

diff --git a/src/shims/build.xml b/src/shims/build.xml
index a4dbac3..28456e3 100644
--- a/src/shims/build.xml
+++ b/src/shims/build.xml
@@ -52,6 +52,16 @@ to call at top-level: ant deploy-contrib compile-core-test
     <path refid="common-classpath"/>
   </path>
 
+  <path id="test.classpath">
+    <pathelement location="${test.build.classes}" />
+    <pathelement location="" />
+    <pathelement location="${test.src.data.dir}/conf"/>
+    <pathelement location="${hive.conf.dir}"/>
+    <!-- We are running unit tests like the one inside ql -->
+    <fileset dir="${hive.root}" includes="testlibs/*.jar"/>
+    <path refid="classpath"/>
+  </path>
+
   <!-- default list of shims to build -->
   <property name="shims.include" value="0.20,0.20S,0.23"/>
   <property name="shims.common.sources" value="${basedir}/src/common/java"/>	
@@ -112,7 +122,7 @@ to call at top-level: ant deploy-contrib compile-core-test
      deprecation="${javac.deprecation}"
      includeantruntime="false">
       <compilerarg line="${javac.args} ${javac.args.warnings}" />
-      <classpath refid="classpath"/>
+      <classpath refid="test.classpath"/>
     </javac>
     <javac
      encoding="${build.encoding}"
@@ -126,7 +136,7 @@ to call at top-level: ant deploy-contrib compile-core-test
      deprecation="${javac.deprecation}"
      includeantruntime="false">
       <compilerarg line="${javac.args} ${javac.args.warnings}" />
-      <classpath refid="classpath"/>
+      <classpath refid="test.classpath"/>
     </javac>
   </target>
   
-- 
1.7.0.4

