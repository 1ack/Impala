From 5e7d215772ad31852fab777949c5ce040e7d0df4 Mon Sep 17 00:00:00 2001
From: Andrew Bayer <andrew@cloudera.com>
Date: Mon, 9 Jan 2012 13:48:01 -0800
Subject: [PATCH 07/58] CLOUDERA-BUILD. Add hadoop-mapreduce-client-jobclient-*-tests.jar as
 dependency for hive-exec tests.

---
 build-common.xml |    2 ++
 ql/build.xml     |    3 +++
 ql/ivy.xml       |    8 ++++++++
 3 files changed, 13 insertions(+), 0 deletions(-)

diff --git a/src/build-common.xml b/src/build-common.xml
index 2a91d5a..c315aa2 100644
--- a/src/build-common.xml
+++ b/src/build-common.xml
@@ -105,6 +105,8 @@
       <exclude name="share/hadoop/common/lib/hadoop-mapreduce-*.jar" />
       <exclude name="share/hadoop/common/lib/hadoop-yarn-*.jar" />
     </fileset>
+    <!-- Hack to get jobclient test jar in classpath. -->
+    <fileset dir="${hive.root}/build/ivy/lib/default" includes="hadoop-mapreduce-client-jobclient-*-tests.jar" />
   </path>
 
 
diff --git a/src/ql/build.xml b/src/ql/build.xml
index 3fe0471..7dec1b4 100644
--- a/src/ql/build.xml
+++ b/src/ql/build.xml
@@ -61,6 +61,9 @@
     </fileset>
 
     <path refid="classpath"/>
+    <!-- Hack to get jobclient test jar in classpath. -->
+    <fileset dir="${hive.root}/build/ivy/lib/default" includes="hadoop-mapreduce-client-jobclient-*-tests.jar" />
+
   </path>
 
   <target name="thriftif" depends="check-thrift-home">
diff --git a/src/ql/ivy.xml b/src/ql/ivy.xml
index c9bb3d4..96281c2 100644
--- a/src/ql/ivy.xml
+++ b/src/ql/ivy.xml
@@ -60,5 +60,13 @@
     <dependency org="commons-logging" name="commons-logging-api" rev="${commons-logging-api.version}"
                 transitive="false"/>
     <dependency org="org.apache.derby" name="derby" rev="${derby.version}"/>
+
+    <!-- Hack to get jobclient tests dependency in. -->
+    <dependency org="org.apache.hadoop" name="hadoop-mapreduce-client-jobclient" rev="${hadoop.version.ant-internal}">
+      <artifact name="hadoop-mapreduce-client-jobclient" ext="jar" />
+      <artifact name="hadoop-mapreduce-client-jobclient" type="tests" ext="jar" m:classifier="tests"/>
+      <exclude org="commons-daemon" module="commons-daemon"/><!--bad POM-->
+      <exclude org="org.apache.commons" module="commons-daemon"/><!--bad POM-->
+    </dependency>
   </dependencies>
 </ivy-module>
-- 
1.7.0.4

