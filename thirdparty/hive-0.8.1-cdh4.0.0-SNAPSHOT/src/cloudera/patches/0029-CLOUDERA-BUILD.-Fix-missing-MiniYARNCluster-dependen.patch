From 95427de40c069fc7da8b86df5c8a4e2ef97b6d2c Mon Sep 17 00:00:00 2001
From: Carl Steinbach <carl@cloudera.com>
Date: Thu, 1 Mar 2012 15:35:42 -0800
Subject: [PATCH 29/58] CLOUDERA-BUILD. Fix missing MiniYARNCluster dependency

Reason: Bug
Author: Carl Steinbach
Ref: CDH-4540
---
 build-common.xml      |    2 ++
 hbase-handler/ivy.xml |    6 ++++++
 ql/ivy.xml            |    6 ++++++
 3 files changed, 14 insertions(+), 0 deletions(-)

diff --git a/src/build-common.xml b/src/build-common.xml
index 26bc7be..0b75a2f 100644
--- a/src/build-common.xml
+++ b/src/build-common.xml
@@ -104,6 +104,8 @@
     </fileset>
     <!-- Hack to get jobclient test jar in classpath. -->
     <fileset dir="${hive.root}/build/ivy/lib" includes="test/hadoop-mapreduce-client-jobclient-*-tests.jar" />
+    <!-- Hack to get MiniYARNCluster in classpath for Minimr tests -->
+    <fileset dir="${hive.root}/build/ivy/lib" includes="test/hadoop-yarn-server-tests-*-tests.jar" />
   </path>
   
   <path id="test.classpath">
diff --git a/src/hbase-handler/ivy.xml b/src/hbase-handler/ivy.xml
index bf24ba0..041e38a 100644
--- a/src/hbase-handler/ivy.xml
+++ b/src/hbase-handler/ivy.xml
@@ -51,5 +51,11 @@
     </dependency>
     <dependency org="org.apache.zookeeper" name="zookeeper" rev="${zookeeper.version}"
                 transitive="false"/>
+    
+    <!-- Hack to get MiniYARNCluster for Minimr tests -->
+    <dependency org="org.apache.hadoop" name="hadoop-yarn-server-tests" rev="${hadoop.version.ant-internal}"
+                conf="test->default">
+      <artifact name="hadoop-yarn-server-tests" type="tests" ext="jar" m:classifier="tests"/>
+    </dependency>
   </dependencies>
 </ivy-module>
diff --git a/src/ql/ivy.xml b/src/ql/ivy.xml
index 3ae37e8..cb10a24 100644
--- a/src/ql/ivy.xml
+++ b/src/ql/ivy.xml
@@ -69,5 +69,11 @@
       <exclude org="commons-daemon" module="commons-daemon"/><!--bad POM-->
       <exclude org="org.apache.commons" module="commons-daemon"/><!--bad POM-->
     </dependency>
+    
+    <!-- Hack to get MiniYARNCluster for Minimr tests -->
+    <dependency org="org.apache.hadoop" name="hadoop-yarn-server-tests" rev="${hadoop.version.ant-internal}"
+                conf="test->default">
+      <artifact name="hadoop-yarn-server-tests" type="tests" ext="jar" m:classifier="tests"/>
+    </dependency>
   </dependencies>
 </ivy-module>
-- 
1.7.0.4

